syntax = 'proto3';

option  go_package = 'github.com/manaaan/ekolivs-oms/backend/specs/demand_api';

import "google/protobuf/empty.proto";

service DemandService {
  rpc GetDemands(DemandsReq) returns (DemandsRes) {}
  rpc CreateDemand(CreateDemandReq) returns (Demand) {}
  rpc DeleteDemand(IdReq) returns (google.protobuf.Empty) {}
}

message DemandsReq {
  optional string member = 1; // member identification, initially with an E-mail
}

message DemandsRes {
  repeated Demand demands = 1;
}

message CreateDemandReq {
  repeated Position positions = 1;
}

message IdReq {
  string id = 1;
}

message Demand {
  string ID = 1;
  // @gotags: firestore:"positions,omitempty"
  repeated Position positions = 2;
  Status status = 3;
  optional string fulfilledAt = 4;
  string createdAt = 5;
  string member = 6; // member identification, initially with an E-mail
}

message Position {
  string ID = 1;
  string productId = 2;
  int32 amount = 3;
  int32 position = 4;
}

enum Status {
  RECEIVED = 0;
  ACCEPTED = 1;
  REJECTED = 2;
  IN_PROGRESS = 3;
  FULFILLED = 4; // The order contained the demand, so it has been fulfilled and can be collected.
  CONCLUDED = 5; // The member has collected the order.
}